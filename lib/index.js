"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.punycode = exports.whois = exports.reverse = exports.groper = void 0;

var dns = _interopRequireWildcard(require("native-dns"));

var _net = _interopRequireDefault(require("net"));

var _punycode = _interopRequireDefault(require("punycode"));

var _tldjs = _interopRequireDefault(require("tldjs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var topLevelWhoisServerDomai = 'whois-servers.net';
var dnsTypes = ['A', 'AAAA', 'NS', 'CNAME', 'PTR', 'NAPTR', 'TXT', 'MX', 'SRV', 'SOA', 'TLSA'];
var ipMatcher = /^(?:(?:2[0-4]\d|25[0-5]|1\d{2}|[1-9]?\d)\.){3}(?:2[0-4]\d|25[0-5]|1\d{2}|[1-9]?\d)$/;
var defaultDnsServer = {
  address: '1.1.1.1',
  port: 53,
  type: 'tcp'
};
var defaultTimeout = 3000;
/**
 * node-dns wrapper method.
 * type is resource record type. example "A", "MX" etc.
 * option is node-dns remote end point option.
 * { address: "ip address", port: "remote port number", type: "udp or tcp"}
 * timeout is a number in milliseconds that is wait for the request to finish.
 *
 * @param {String} domain
 * @param {Array} types
 * @param {IdnsServer} option
 * @param {Number} timeout
 * @returns {Promise}
 */

function requestDns(domain, types, option, timeout) {
  var promises = [];
  var recordTypes = [];

  if (!types || types.length === 0) {
    recordTypes = ['A'];
  } else {
    recordTypes = types;
  }

  recordTypes.map(function (type) {
    promises.push(ajaxRequest(domain, type, option, timeout));
  });
  return new Promise(function (resolve, reject) {
    Promise.all(promises).then(function (values) {
      var response = {};
      values.map(function (obj) {
        Object.keys(obj).map(function (k) {
          response[k] = obj[k];
        });
      });
      resolve(response);
    }).catch(function (err) {
      reject(err);
    });
  });
}
/**
 * This method asynchronously requests the dns server.
 * This method return promise object as execution result.
 *
 * @param {String} domain
 * @param {Array} type
 * @param {IdnsServer} dnsServer
 * @param {Number} timeout
 * @returns {Promise}
 */


function ajaxRequest(domain, type, dnsServer) {
  var timeout = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : defaultTimeout;
  var server = defaultDnsServer;
  return new Promise(function (resolve, reject) {
    var questionOpts = {
      name: domain,
      type: type
    };
    var requestOption = {
      cache: false,
      question: dns.Question(questionOpts),
      server: Object.assign(server, dnsServer),
      timeout: timeout
    };

    if (timeout) {
      requestOption.timeout = timeout;
    }

    var request = dns.Request(requestOption);
    request.on('timeout', function () {
      reject(new Error('DNS request timed out'));
    });
    request.on('cancelled', function () {
      reject(new Error('DNS request cancelled'));
    });
    request.on('error', function (error) {
      reject(error);
    });
    request.on('message', function (_, response) {
      resolve(_defineProperty({}, type, response.answer));
    });
    request.send();
  });
}
/**
 * Validate resource record type.
 *
 * @param {Array|String} types
 * @return {Array}
 */


function validateDnsType(types) {
  if (!types || types !== 'ANY' && typeof types.length !== 'number') {
    throw new Error('Expected a `types is Array`');
  }

  var recordTypes;
  var validTypes = [];

  if (types === 'ANY' || types.includes('ANY')) {
    recordTypes = dnsTypes;
  } else {
    if (typeof types === 'string') {
      recordTypes = [types];
    } else {
      recordTypes = types;
    }
  }

  recordTypes.forEach(function (type) {
    var matched = dnsTypes.find(function (elem) {
      return type.toUpperCase() === elem;
    });

    if (typeof matched === 'string') {
      validTypes.push(matched);
    }
  });
  return validTypes;
}
/**
 * Get Whois server and Whois domain.
 * First, Make the FQDN that was the TLD + whois-servers.net.
 *
 * @param {String} domain
 * @param {Object} options
 * @return {Promise}
 */


function requestWhois(domain, options) {
  var whoisServer, port;
  return new Promise(function (resolve, reject) {
    var func = function func(domain, whoisServer, port) {
      getWhoisDomain(domain, whoisServer, port).then(function (data) {
        resolve(data);
      }).catch(function (error) {
        reject(error);
      });
    };

    if (options && options.server) {
      whoisServer = options.server;

      if (options.port) {
        port = options.port;
      }

      func.call(null, domain, whoisServer, port);
    } else {
      getTopLevelWhoisServer(domain).then(function (whoisServers) {
        whoisServer = whoisServers[0];
        func.call(null, domain, whoisServer, port);
      }).catch(function (error) {
        reject(error);
      });
    }
  });
}
/**
 * Get the whois server of the top level domain
 *
 * @param {String} domain
 * @return {Promise}
 */


function getTopLevelWhoisServer(domain) {
  var tmp = domain.split('.'),
      tld = tmp[tmp.length - 1],
      cname = "".concat(tld, ".").concat(topLevelWhoisServerDomai),
      messege = {
    not_found: 'Whois Server `NOT FOUND`'
  };
  return new Promise(function (resolve, reject) {
    dns.resolveCname(cname, function (error, servers) {
      if (servers && servers.length > 0) {
        resolve(servers);
      } else {
        !error ? reject(messege.not_found) : reject(error);
      }
    });
  });
}
/**
 * Get whois information of the domain
 *
 * @param {String} domain
 * @param {String} server
 * @return {Promise}
 */


function getWhoisDomain(domain, server) {
  var port = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 43;

  if (!domain) {
    throw new Error('`domain` is required');
  }

  if (!server) {
    throw new Error('`server` is required');
  }

  var socket = new _net.default.Socket();
  var encoding = 'utf8';
  return new Promise(function (resolve, reject) {
    socket.setEncoding(encoding);
    socket.connect(port, server, function () {
      socket.end(domain + '\r\n', encoding);
    });
    socket.on('data', function (data) {
      resolve(data);
    });
    socket.on('error', function (error) {
      reject(error);
    });
  });
}
/**
 * IP address reverse.
 * support ipv4 only.
 *
 * @param {String} ip
 * @return {Promise}
 */


function reverseDomain(ip) {
  if (!ipMatcher.test(ip)) {
    throw new Error('IP is not valid');
  }

  return new Promise(function (resolve, reject) {
    dns.reverse(ip, function (error, hostname) {
      if (reverse) {
        resolve(hostname);
      } else {
        reject(error);
      }
    });
  });
}
/**
 * Decode Punycode.
 *
 * @param {String} ascii
 * @return {String}
 */


function decodePuny(ascii) {
  return _punycode.default.toUnicode(ascii);
}
/**
 * Encode Punycode.
 *
 * @param {String} unicode
 * @return {String}
 */


function encodePuny(unicode) {
  return _punycode.default.toASCII(unicode);
}

var groper = function groper(domain, types, options, cb) {
  if (typeof domain !== 'string') {
    throw new Error('Expected a `domain`');
  }

  var defaultOptions = {
    server: defaultDnsServer,
    timeout: defaultTimeout
  };
  var callback;
  var requestOptions = defaultOptions;

  if (typeof types === 'function') {
    callback = types;
  } else if (typeof options === 'function') {
    callback = options;
    requestOptions = Object.assign(defaultOptions, cb);
  } else if (cb) {
    requestOptions = Object.assign(defaultOptions, options);
    callback = cb;
  }

  var domainName = encodePuny(domain);
  var type,
      server,
      timeout,
      resourceTypes = ['ANY'];

  if (typeof types === 'string') {
    resourceTypes = new Array(types);
  }

  if (Array.isArray(types)) {
    resourceTypes = types;
  }

  if (resourceTypes.includes('ANY')) {
    resourceTypes = ['ANY'];
  }

  type = validateDnsType(resourceTypes);

  if (type.length === 0) {
    throw new Error('Valid No `DNS TYPE` exitst');
  }

  if (requestOptions.server) {
    server = requestOptions.server;
  }

  if (requestOptions.timeout) {
    timeout = requestOptions.timeout;
  }

  var promise = requestDns(domainName, type, server, timeout);

  if (callback && typeof callback === 'function') {
    promise.then(function (data) {
      return callback(null, data);
    }).catch(function (error) {
      return callback(error, null);
    });
  } else {
    return promise;
  }
};

exports.groper = groper;

var reverse = function reverse(ip, cb) {
  if (typeof ip !== 'string') {
    throw new Error('Expected a `ip address`');
  }

  var promise = reverseDomain(ip);

  if (cb && typeof cb === 'function') {
    promise.then(function (data) {
      return cb(null, data);
    }).catch(function (error) {
      return cb(error, null);
    });
  } else {
    return promise;
  }
};

exports.reverse = reverse;

var whois = function whois(domain, opts, cb) {
  if (typeof domain !== 'string') {
    throw new Error('Expected a `domain name`');
  }

  var callback;

  if (typeof opts === 'function') {
    callback = opts;
  } else {
    callback = cb;
  }

  if (_tldjs.default.tldExists(domain) === false) {
    throw new Error('Invalid a `domain name`');
  }

  var encodedDomain = "".concat(encodePuny(domain)),
      promise = requestWhois(encodedDomain, opts);

  if (callback && typeof callback === 'function') {
    promise.then(function (data) {
      return callback(null, data);
    }).catch(function (error) {
      return callback(error, null);
    });
  } else {
    return promise;
  }
};

exports.whois = whois;

var punycode = function punycode(ascii_or_unicode) {
  var type = ascii_or_unicode.match(/^xn--/) ? 'decode' : 'encode';

  if (type === 'decode') {
    return decodePuny(ascii_or_unicode);
  } else {
    return encodePuny(ascii_or_unicode);
  }
};

exports.punycode = punycode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJ0b3BMZXZlbFdob2lzU2VydmVyRG9tYWkiLCJkbnNUeXBlcyIsImlwTWF0Y2hlciIsImRlZmF1bHREbnNTZXJ2ZXIiLCJhZGRyZXNzIiwicG9ydCIsInR5cGUiLCJkZWZhdWx0VGltZW91dCIsInJlcXVlc3REbnMiLCJkb21haW4iLCJ0eXBlcyIsIm9wdGlvbiIsInRpbWVvdXQiLCJwcm9taXNlcyIsInJlY29yZFR5cGVzIiwibGVuZ3RoIiwibWFwIiwicHVzaCIsImFqYXhSZXF1ZXN0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJhbGwiLCJ0aGVuIiwidmFsdWVzIiwicmVzcG9uc2UiLCJvYmoiLCJPYmplY3QiLCJrZXlzIiwiayIsImNhdGNoIiwiZXJyIiwiZG5zU2VydmVyIiwic2VydmVyIiwicXVlc3Rpb25PcHRzIiwibmFtZSIsInJlcXVlc3RPcHRpb24iLCJjYWNoZSIsInF1ZXN0aW9uIiwiZG5zIiwiUXVlc3Rpb24iLCJhc3NpZ24iLCJyZXF1ZXN0IiwiUmVxdWVzdCIsIm9uIiwiRXJyb3IiLCJlcnJvciIsIl8iLCJhbnN3ZXIiLCJzZW5kIiwidmFsaWRhdGVEbnNUeXBlIiwidmFsaWRUeXBlcyIsImluY2x1ZGVzIiwiZm9yRWFjaCIsIm1hdGNoZWQiLCJmaW5kIiwiZWxlbSIsInRvVXBwZXJDYXNlIiwicmVxdWVzdFdob2lzIiwib3B0aW9ucyIsIndob2lzU2VydmVyIiwiZnVuYyIsImdldFdob2lzRG9tYWluIiwiZGF0YSIsImNhbGwiLCJnZXRUb3BMZXZlbFdob2lzU2VydmVyIiwid2hvaXNTZXJ2ZXJzIiwidG1wIiwic3BsaXQiLCJ0bGQiLCJjbmFtZSIsIm1lc3NlZ2UiLCJub3RfZm91bmQiLCJyZXNvbHZlQ25hbWUiLCJzZXJ2ZXJzIiwic29ja2V0IiwibmV0IiwiU29ja2V0IiwiZW5jb2RpbmciLCJzZXRFbmNvZGluZyIsImNvbm5lY3QiLCJlbmQiLCJyZXZlcnNlRG9tYWluIiwiaXAiLCJ0ZXN0IiwicmV2ZXJzZSIsImhvc3RuYW1lIiwiZGVjb2RlUHVueSIsImFzY2lpIiwicHVueSIsInRvVW5pY29kZSIsImVuY29kZVB1bnkiLCJ1bmljb2RlIiwidG9BU0NJSSIsImdyb3BlciIsImNiIiwiZGVmYXVsdE9wdGlvbnMiLCJjYWxsYmFjayIsInJlcXVlc3RPcHRpb25zIiwiZG9tYWluTmFtZSIsInJlc291cmNlVHlwZXMiLCJBcnJheSIsImlzQXJyYXkiLCJwcm9taXNlIiwid2hvaXMiLCJvcHRzIiwidGxkanMiLCJ0bGRFeGlzdHMiLCJlbmNvZGVkRG9tYWluIiwicHVueWNvZGUiLCJhc2NpaV9vcl91bmljb2RlIiwibWF0Y2giXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFFQSxJQUFNQSx3QkFBd0IsR0FBRyxtQkFBakM7QUE4Q0EsSUFBTUMsUUFBa0IsR0FBRyxDQUN2QixHQUR1QixFQUV2QixNQUZ1QixFQUd2QixJQUh1QixFQUl2QixPQUp1QixFQUt2QixLQUx1QixFQU12QixPQU51QixFQU92QixLQVB1QixFQVF2QixJQVJ1QixFQVN2QixLQVR1QixFQVV2QixLQVZ1QixFQVd2QixNQVh1QixDQUEzQjtBQWNBLElBQU1DLFNBQWlCLEdBQUcscUZBQTFCO0FBQ0EsSUFBTUMsZ0JBQTRCLEdBQUc7QUFDakNDLEVBQUFBLE9BQU8sRUFBRSxTQUR3QjtBQUVqQ0MsRUFBQUEsSUFBSSxFQUFFLEVBRjJCO0FBR2pDQyxFQUFBQSxJQUFJLEVBQUU7QUFIMkIsQ0FBckM7QUFLQSxJQUFNQyxjQUFjLEdBQUcsSUFBdkI7QUFFQTs7Ozs7Ozs7Ozs7Ozs7QUFhQSxTQUFTQyxVQUFULENBQW9CQyxNQUFwQixFQUFvQ0MsS0FBcEMsRUFBc0RDLE1BQXRELEVBQTJFQyxPQUEzRSxFQUEyRztBQUN2RyxNQUFNQyxRQUE2QixHQUFHLEVBQXRDO0FBRUEsTUFBSUMsV0FBcUIsR0FBRyxFQUE1Qjs7QUFFQSxNQUFJLENBQUNKLEtBQUQsSUFB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TUFBSXpHLElBQUksS0FBSyxRQUFiLEVBQXVCO0FBQ25CLFdBQU9pRixVQUFVLENBQUN1QixnQkFBRCxDQUFqQjtBQUNILEdBRkQsTUFFTztBQUNILFdBQU9uQixVQUFVLENBQUNtQixnQkFBRCxDQUFqQjtBQUNIO0FBQ0osQ0FQTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGRucyBmcm9tICduYXRpdmUtZG5zJ1xuaW1wb3J0IG5ldCBmcm9tICduZXQnXG5pbXBvcnQgcHVueSBmcm9tICdwdW55Y29kZSdcbmltcG9ydCB0bGRqcyBmcm9tICd0bGRqcydcblxuY29uc3QgdG9wTGV2ZWxXaG9pc1NlcnZlckRvbWFpID0gJ3dob2lzLXNlcnZlcnMubmV0J1xuXG50eXBlIGNhbGxiYWNrRnVuY3Rpb24gPSAoZXJyOiBFcnJvciB8IG51bGwgfCB1bmRlZmluZWQsIGRhdGE6IGFueSkgPT4gYW55XG5cbmludGVyZmFjZSBJd2hvaXNTZXJ2ZXIge1xuICAgIHJlY29yZFR5cGU/OiBzdHJpbmdcbiAgICBzZXJ2ZXI/OiBzdHJpbmdcbiAgICBwb3J0PzogbnVtYmVyXG59XG5cbmludGVyZmFjZSBJZG5zU2VydmVyIHtcbiAgICBhZGRyZXNzOiBzdHJpbmdcbiAgICBwb3J0OiBudW1iZXJcbiAgICB0eXBlOiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIElkbnNSZXNwb25zZSB7XG4gICAgW3R5cGU6IHN0cmluZ106IElkbnNBbnN3ZXJcbn1cblxuaW50ZXJmYWNlIElkbnNSZXF1ZXN0UGFyYW1zIHtcbiAgICBxdWVzdGlvbj86IElkbnNRdWVzdGlvblJlc3BvbnNlXG4gICAgc2VydmVyPzogSWRuc1NlcnZlclxuICAgIHRpbWVvdXQ/OiBudW1iZXJcbiAgICBjYWNoZT86IGJvb2xlYW5cbn1cblxuaW50ZXJmYWNlIElkbnNRdWVzdGlvblJlc3BvbnNlIHtcbiAgICBuYW1lPzogc3RyaW5nXG4gICAgdHlwZTogc3RyaW5nXG4gICAgY2xhc3M6IHN0cmluZ1xufVxuXG5pbnRlcmZhY2UgSWRuc0Fuc3dlciB7XG4gICAgbmFtZTogc3RyaW5nXG4gICAgdHlwZTogbnVtYmVyXG4gICAgY2xhc3M6IG51bWJlclxuICAgIHR0bDogbnVtYmVyXG4gICAgYWRkcmVzcz86IHN0cmluZ1xuICAgIGRhdGE/OiBzdHJpbmcgfCBzdHJpbmdbXVxufVxuXG5pbnRlcmZhY2UgZ3JvcGVyUmVzdWx0IHtcbiAgICBbdHlwZTogc3RyaW5nXTogSWRuc1F1ZXN0aW9uUmVzcG9uc2VbXVxufVxuXG5jb25zdCBkbnNUeXBlczogc3RyaW5nW10gPSBbXG4gICAgJ0EnLFxuICAgICdBQUFBJyxcbiAgICAnTlMnLFxuICAgICdDTkFNRScsXG4gICAgJ1BUUicsXG4gICAgJ05BUFRSJyxcbiAgICAnVFhUJyxcbiAgICAnTVgnLFxuICAgICdTUlYnLFxuICAgICdTT0EnLFxuICAgICdUTFNBJyxcbl1cblxuY29uc3QgaXBNYXRjaGVyOiBSZWdFeHAgPSAvXig/Oig/OjJbMC00XVxcZHwyNVswLTVdfDFcXGR7Mn18WzEtOV0/XFxkKVxcLil7M30oPzoyWzAtNF1cXGR8MjVbMC01XXwxXFxkezJ9fFsxLTldP1xcZCkkL1xuY29uc3QgZGVmYXVsdERuc1NlcnZlcjogSWRuc1NlcnZlciA9IHtcbiAgICBhZGRyZXNzOiAnMS4xLjEuMScsXG4gICAgcG9ydDogNTMsXG4gICAgdHlwZTogJ3RjcCcsXG59XG5jb25zdCBkZWZhdWx0VGltZW91dCA9IDMwMDBcblxuLyoqXG4gKiBub2RlLWRucyB3cmFwcGVyIG1ldGhvZC5cbiAqIHR5cGUgaXMgcmVzb3VyY2UgcmVjb3JkIHR5cGUuIGV4YW1wbGUgXCJBXCIsIFwiTVhcIiBldGMuXG4gKiBvcHRpb24gaXMgbm9kZS1kbnMgcmVtb3RlIGVuZCBwb2ludCBvcHRpb24uXG4gKiB7IGFkZHJlc3M6IFwiaXAgYWRkcmVzc1wiLCBwb3J0OiBcInJlbW90ZSBwb3J0IG51bWJlclwiLCB0eXBlOiBcInVkcCBvciB0Y3BcIn1cbiAqIHRpbWVvdXQgaXMgYSBudW1iZXIgaW4gbWlsbGlzZWNvbmRzIHRoYXQgaXMgd2FpdCBmb3IgdGhlIHJlcXVlc3QgdG8gZmluaXNoLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBkb21haW5cbiAqIEBwYXJhbSB7QXJyYXl9IHR5cGVzXG4gKiBAcGFyYW0ge0lkbnNTZXJ2ZXJ9IG9wdGlvblxuICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXRcbiAqIEByZXR1cm5zIHtQcm9taXNlfVxuICovXG5mdW5jdGlvbiByZXF1ZXN0RG5zKGRvbWFpbjogc3RyaW5nLCB0eXBlcz86IHN0cmluZ1tdLCBvcHRpb24/OiBJZG5zU2VydmVyLCB0aW1lb3V0PzogbnVtYmVyKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCBwcm9taXNlczogQXJyYXk8UHJvbWlzZTxhbnk+PiA9IFtdXG5cbiAgICBsZXQgcmVjb3JkVHlwZXM6IHN0cmluZ1tdID0gW11cblxuICAgIGlmICghdHlwZXMgfHwgdHlwZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJlY29yZFR5cGVzID0gWydBJ11cbiAgICB9IGVsc2Uge1xuICAgICAgICByZWNvcmRUeXBlcyA9IHR5cGVzXG4gICAgfVxuXG4gICAgcmVjb3JkVHlwZXMubWFwKCh0eXBlKSA9PiB7XG4gICAgICAgIHByb21pc2VzLnB1c2goYWpheFJlcXVlc3QoZG9tYWluLCB0eXBlLCBvcHRpb24sIHRpbWVvdXQpKVxuICAgIH0pXG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBQcm9taXNlXG4gICAgICAgICAgICAuYWxsKHByb21pc2VzKVxuICAgICAgICAgICAgLnRoZW4oKHZhbHVlcykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlOiB7XG4gICAgICAgICAgICAgICAgICAgIFt4OiBzdHJpbmddOiBJZG5zQW5zd2VyW10sXG4gICAgICAgICAgICAgICAgfSA9IHt9XG5cbiAgICAgICAgICAgICAgICB2YWx1ZXMubWFwKChvYmopID0+IHtcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMob2JqKS5tYXAoKGspID0+IHsgcmVzcG9uc2Vba10gPSBvYmpba10gfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgfSlcbiAgICB9KVxufVxuXG4vKipcbiAqIFRoaXMgbWV0aG9kIGFzeW5jaHJvbm91c2x5IHJlcXVlc3RzIHRoZSBkbnMgc2VydmVyLlxuICogVGhpcyBtZXRob2QgcmV0dXJuIHByb21pc2Ugb2JqZWN0IGFzIGV4ZWN1dGlvbiByZXN1bHQuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IGRvbWFpblxuICogQHBhcmFtIHtBcnJheX0gdHlwZVxuICogQHBhcmFtIHtJZG5zU2VydmVyfSBkbnNTZXJ2ZXJcbiAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lb3V0XG4gKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAqL1xuZnVuY3Rpb24gYWpheFJlcXVlc3QoZG9tYWluOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgZG5zU2VydmVyPzogSWRuc1NlcnZlciwgdGltZW91dDogbnVtYmVyID0gZGVmYXVsdFRpbWVvdXQpOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IHNlcnZlcjogSWRuc1NlcnZlciA9IGRlZmF1bHREbnNTZXJ2ZXJcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHF1ZXN0aW9uT3B0cyA9IHtcbiAgICAgICAgICAgIG5hbWU6IGRvbWFpbixcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXF1ZXN0T3B0aW9uOiBJZG5zUmVxdWVzdFBhcmFtcyA9IHtcbiAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgIHF1ZXN0aW9uOiBkbnMuUXVlc3Rpb24ocXVlc3Rpb25PcHRzKSxcbiAgICAgICAgICAgIHNlcnZlcjogT2JqZWN0LmFzc2lnbihzZXJ2ZXIsIGRuc1NlcnZlciksXG4gICAgICAgICAgICB0aW1lb3V0LFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRpbWVvdXQpIHsgcmVxdWVzdE9wdGlvbi50aW1lb3V0ID0gdGltZW91dCB9XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBkbnMuUmVxdWVzdChyZXF1ZXN0T3B0aW9uKVxuXG4gICAgICAgIHJlcXVlc3Qub24oJ3RpbWVvdXQnLCAoKSA9PiB7XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdETlMgcmVxdWVzdCB0aW1lZCBvdXQnKSlcbiAgICAgICAgfSlcblxuICAgICAgICByZXF1ZXN0Lm9uKCdjYW5jZWxsZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdETlMgcmVxdWVzdCBjYW5jZWxsZWQnKSlcbiAgICAgICAgfSlcblxuICAgICAgICByZXF1ZXN0Lm9uKCdlcnJvcicsIChlcnJvcjogRXJyb3IpID0+IHtcbiAgICAgICAgICAgIHJlamVjdChlcnJvcilcbiAgICAgICAgfSlcblxuICAgICAgICByZXF1ZXN0Lm9uKCdtZXNzYWdlJywgKF86IEVycm9yLCByZXNwb25zZTogYW55KSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICBbdHlwZV06IHJlc3BvbnNlLmFuc3dlcixcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmVxdWVzdC5zZW5kKClcbiAgICB9KVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIHJlc291cmNlIHJlY29yZCB0eXBlLlxuICpcbiAqIEBwYXJhbSB7QXJyYXl8U3RyaW5nfSB0eXBlc1xuICogQHJldHVybiB7QXJyYXl9XG4gKi9cblxuZnVuY3Rpb24gdmFsaWRhdGVEbnNUeXBlKHR5cGVzPzogc3RyaW5nIHwgc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgaWYgKCF0eXBlcyB8fCAodHlwZXMgIT09ICdBTlknICYmIHR5cGVvZiB0eXBlcy5sZW5ndGggIT09ICdudW1iZXInKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGEgYHR5cGVzIGlzIEFycmF5YCcpXG4gICAgfVxuXG4gICAgbGV0IHJlY29yZFR5cGVzOiBzdHJpbmdbXVxuICAgIGNvbnN0IHZhbGlkVHlwZXM6IHN0cmluZ1tdID0gW11cblxuICAgIGlmICh0eXBlcyA9PT0gJ0FOWScgfHwgdHlwZXMuaW5jbHVkZXMoJ0FOWScpKSB7XG4gICAgICAgIHJlY29yZFR5cGVzID0gZG5zVHlwZXNcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodHlwZW9mIHR5cGVzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmVjb3JkVHlwZXMgPSBbdHlwZXNdXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZWNvcmRUeXBlcyA9IHR5cGVzXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZWNvcmRUeXBlcy5mb3JFYWNoKCh0eXBlKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hdGNoZWQgPSBkbnNUeXBlcy5maW5kKCBlbGVtID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0eXBlLnRvVXBwZXJDYXNlKCkgPT09IGVsZW1cbiAgICAgICAgfSlcblxuICAgICAgICBpZiAodHlwZW9mIG1hdGNoZWQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB2YWxpZFR5cGVzLnB1c2gobWF0Y2hlZClcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICByZXR1cm4gdmFsaWRUeXBlc1xufVxuXG4vKipcbiAqIEdldCBXaG9pcyBzZXJ2ZXIgYW5kIFdob2lzIGRvbWFpbi5cbiAqIEZpcnN0LCBNYWtlIHRoZSBGUUROIHRoYXQgd2FzIHRoZSBUTEQgKyB3aG9pcy1zZXJ2ZXJzLm5ldC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gZG9tYWluXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICogQHJldHVybiB7UHJvbWlzZX1cbiAqL1xuZnVuY3Rpb24gcmVxdWVzdFdob2lzKGRvbWFpbjogc3RyaW5nLCBvcHRpb25zPzogYW55KTogUHJvbWlzZTxhbnk+IHtcbiAgICBsZXQgd2hvaXNTZXJ2ZXI6IHN0cmluZyxcbiAgICAgICAgcG9ydDogbnVtYmVyXG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCBmdW5jID0gKGRvbWFpbjogc3RyaW5nLCB3aG9pc1NlcnZlcjogc3RyaW5nLCBwb3J0OiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIGdldFdob2lzRG9tYWluKGRvbWFpbiwgd2hvaXNTZXJ2ZXIsIHBvcnQpXG4gICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHsgcmVzb2x2ZShkYXRhKSB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsgcmVqZWN0KGVycm9yKSB9KVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zZXJ2ZXIpIHtcbiAgICAgICAgICAgIHdob2lzU2VydmVyID0gb3B0aW9ucy5zZXJ2ZXJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnBvcnQpIHsgcG9ydCA9IG9wdGlvbnMucG9ydCB9XG4gICAgICAgICAgICBmdW5jLmNhbGwobnVsbCwgZG9tYWluLCB3aG9pc1NlcnZlciwgcG9ydClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdldFRvcExldmVsV2hvaXNTZXJ2ZXIoZG9tYWluKS50aGVuKCh3aG9pc1NlcnZlcnMpID0+IHtcbiAgICAgICAgICAgICAgICB3aG9pc1NlcnZlciA9IHdob2lzU2VydmVyc1swXVxuICAgICAgICAgICAgICAgIGZ1bmMuY2FsbChudWxsLCBkb21haW4sIHdob2lzU2VydmVyLCBwb3J0KVxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH0pXG59XG5cbi8qKlxuICogR2V0IHRoZSB3aG9pcyBzZXJ2ZXIgb2YgdGhlIHRvcCBsZXZlbCBkb21haW5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gZG9tYWluXG4gKiBAcmV0dXJuIHtQcm9taXNlfVxuICovXG5mdW5jdGlvbiBnZXRUb3BMZXZlbFdob2lzU2VydmVyKGRvbWFpbjogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCB0bXAgPSBkb21haW4uc3BsaXQoJy4nKSxcbiAgICAgICAgdGxkID0gdG1wW3RtcC5sZW5ndGggLSAxXSxcbiAgICAgICAgY25hbWUgPSBgJHt0bGR9LiR7dG9wTGV2ZWxXaG9pc1NlcnZlckRvbWFpfWAsXG4gICAgICAgIG1lc3NlZ2UgPSB7IG5vdF9mb3VuZDogJ1dob2lzIFNlcnZlciBgTk9UIEZPVU5EYCcgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgZG5zLnJlc29sdmVDbmFtZShjbmFtZSwgKGVycm9yOiBFcnJvciwgc2VydmVyczogYW55KSA9PiB7XG4gICAgICAgICAgICBpZiAoc2VydmVycyAmJiBzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHNlcnZlcnMpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICFlcnJvciA/IHJlamVjdChtZXNzZWdlLm5vdF9mb3VuZCkgOiByZWplY3QoZXJyb3IpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSlcbn1cblxuLyoqXG4gKiBHZXQgd2hvaXMgaW5mb3JtYXRpb24gb2YgdGhlIGRvbWFpblxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBkb21haW5cbiAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2ZXJcbiAqIEByZXR1cm4ge1Byb21pc2V9XG4gKi9cbmZ1bmN0aW9uIGdldFdob2lzRG9tYWluKGRvbWFpbjogc3RyaW5nLCBzZXJ2ZXI6IHN0cmluZywgcG9ydCA9IDQzKTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAoIWRvbWFpbikgeyB0aHJvdyBuZXcgRXJyb3IoJ2Bkb21haW5gIGlzIHJlcXVpcmVkJykgfVxuICAgIGlmICghc2VydmVyKSB7IHRocm93IG5ldyBFcnJvcignYHNlcnZlcmAgaXMgcmVxdWlyZWQnKSB9XG5cbiAgICBjb25zdCBzb2NrZXQgPSBuZXcgbmV0LlNvY2tldCgpXG4gICAgY29uc3QgZW5jb2RpbmcgPSAndXRmOCdcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHNvY2tldC5zZXRFbmNvZGluZyhlbmNvZGluZylcblxuICAgICAgICBzb2NrZXQuY29ubmVjdChwb3J0LCBzZXJ2ZXIsICgpID0+IHtcbiAgICAgICAgICAgIHNvY2tldC5lbmQoZG9tYWluICsgJ1xcclxcbicsIGVuY29kaW5nKVxuICAgICAgICB9KVxuXG4gICAgICAgIHNvY2tldC5vbignZGF0YScsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKGRhdGEpXG4gICAgICAgIH0pXG5cbiAgICAgICAgc29ja2V0Lm9uKCdlcnJvcicsIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KGVycm9yKVxuICAgICAgICB9KVxuICAgIH0pXG59XG5cbi8qKlxuICogSVAgYWRkcmVzcyByZXZlcnNlLlxuICogc3VwcG9ydCBpcHY0IG9ubHkuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IGlwXG4gKiBAcmV0dXJuIHtQcm9taXNlfVxuICovXG5mdW5jdGlvbiByZXZlcnNlRG9tYWluKGlwOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICghaXBNYXRjaGVyLnRlc3QoaXApKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSVAgaXMgbm90IHZhbGlkJylcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBkbnMucmV2ZXJzZShpcCwgKGVycm9yOiBFcnJvciwgaG9zdG5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgaWYgKHJldmVyc2UpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGhvc3RuYW1lKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSlcbn1cblxuLyoqXG4gKiBEZWNvZGUgUHVueWNvZGUuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IGFzY2lpXG4gKiBAcmV0dXJuIHtTdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIGRlY29kZVB1bnkoYXNjaWk6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHB1bnkudG9Vbmljb2RlKGFzY2lpKVxufVxuXG4vKipcbiAqIEVuY29kZSBQdW55Y29kZS5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gdW5pY29kZVxuICogQHJldHVybiB7U3RyaW5nfVxuICovXG5mdW5jdGlvbiBlbmNvZGVQdW55KHVuaWNvZGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHB1bnkudG9BU0NJSSh1bmljb2RlKVxufVxuXG5leHBvcnQgY29uc3QgZ3JvcGVyID0gKGRvbWFpbjogc3RyaW5nLCB0eXBlcz86IGFueSwgb3B0aW9ucz86IElkbnNSZXF1ZXN0UGFyYW1zLCBjYj86IGNhbGxiYWNrRnVuY3Rpb24pOiBQcm9taXNlPGdyb3BlclJlc3VsdD4gfCB2b2lkID0+IHtcbiAgICBpZiAodHlwZW9mIGRvbWFpbiAhPT0gJ3N0cmluZycpIHsgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCBhIGBkb21haW5gJykgfVxuXG4gICAgY29uc3QgZGVmYXVsdE9wdGlvbnM6IElkbnNSZXF1ZXN0UGFyYW1zID0ge1xuICAgICAgICBzZXJ2ZXI6IGRlZmF1bHREbnNTZXJ2ZXIsXG4gICAgICAgIHRpbWVvdXQ6IGRlZmF1bHRUaW1lb3V0LFxuICAgIH1cblxuICAgIGxldCBjYWxsYmFjazogY2FsbGJhY2tGdW5jdGlvblxuICAgIGxldCByZXF1ZXN0T3B0aW9uczogSWRuc1JlcXVlc3RQYXJhbXMgPSBkZWZhdWx0T3B0aW9uc1xuXG4gICAgaWYgKHR5cGVvZiB0eXBlcyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjYWxsYmFjayA9IHR5cGVzXG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnNcbiAgICAgICAgcmVxdWVzdE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRPcHRpb25zLCBjYilcbiAgICB9IGVsc2UgaWYgKGNiKSB7XG4gICAgICAgIHJlcXVlc3RPcHRpb25zID0gT2JqZWN0LmFzc2lnbihkZWZhdWx0T3B0aW9ucywgb3B0aW9ucylcbiAgICAgICAgY2FsbGJhY2sgPSBjYlxuICAgIH1cblxuICAgIGNvbnN0IGRvbWFpbk5hbWUgPSBlbmNvZGVQdW55KGRvbWFpbilcbiAgICBsZXQgdHlwZSwgc2VydmVyLCB0aW1lb3V0LCByZXNvdXJjZVR5cGVzID0gWydBTlknXVxuXG4gICAgaWYgKHR5cGVvZiB0eXBlcyA9PT0gJ3N0cmluZycpIHsgcmVzb3VyY2VUeXBlcyA9IG5ldyBBcnJheSh0eXBlcykgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KHR5cGVzKSkgeyByZXNvdXJjZVR5cGVzID0gdHlwZXMgfVxuICAgIGlmIChyZXNvdXJjZVR5cGVzLmluY2x1ZGVzKCdBTlknKSkgeyByZXNvdXJjZVR5cGVzID0gWydBTlknXSB9XG5cbiAgICB0eXBlID0gdmFsaWRhdGVEbnNUeXBlKHJlc291cmNlVHlwZXMpXG5cbiAgICBpZiAodHlwZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWYWxpZCBObyBgRE5TIFRZUEVgIGV4aXRzdCcpXG4gICAgfVxuXG4gICAgaWYgKHJlcXVlc3RPcHRpb25zLnNlcnZlcikgeyBzZXJ2ZXIgPSByZXF1ZXN0T3B0aW9ucy5zZXJ2ZXIgfVxuICAgIGlmIChyZXF1ZXN0T3B0aW9ucy50aW1lb3V0KSB7IHRpbWVvdXQgPSByZXF1ZXN0T3B0aW9ucy50aW1lb3V0IH1cbiAgICBjb25zdCBwcm9taXNlID0gcmVxdWVzdERucyhkb21haW5OYW1lLCB0eXBlLCBzZXJ2ZXIsIHRpbWVvdXQpXG5cbiAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHByb21pc2VcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiBjYWxsYmFjayhudWxsLCBkYXRhKSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSlcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcHJvbWlzZVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IHJldmVyc2UgPSAoaXA6IHN0cmluZywgY2I6IGNhbGxiYWNrRnVuY3Rpb24pOiBQcm9taXNlPHN0cmluZz4gfCB2b2lkID0+IHtcbiAgICBpZiAodHlwZW9mIGlwICE9PSAnc3RyaW5nJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGEgYGlwIGFkZHJlc3NgJylcbiAgICB9XG5cbiAgICBjb25zdCBwcm9taXNlID0gcmV2ZXJzZURvbWFpbihpcClcblxuICAgIGlmIChjYiAmJiB0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcHJvbWlzZVxuICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IGNiKG51bGwsIGRhdGEpKVxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gY2IoZXJyb3IsIG51bGwpKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBwcm9taXNlXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3Qgd2hvaXMgPSAoZG9tYWluOiBzdHJpbmcsIG9wdHM/OiBJd2hvaXNTZXJ2ZXIsIGNiPzogY2FsbGJhY2tGdW5jdGlvbik6IFByb21pc2U8c3RyaW5nPiB8IHZvaWQgPT4ge1xuICAgIGlmICh0eXBlb2YgZG9tYWluICE9PSAnc3RyaW5nJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGEgYGRvbWFpbiBuYW1lYCcpXG4gICAgfVxuXG4gICAgbGV0IGNhbGxiYWNrOiBjYWxsYmFja0Z1bmN0aW9uXG5cbiAgICBpZiAodHlwZW9mIG9wdHMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY2FsbGJhY2sgPSBvcHRzXG4gICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2sgPSBjYlxuICAgIH1cblxuICAgIGlmICh0bGRqcy50bGRFeGlzdHMoZG9tYWluKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGEgYGRvbWFpbiBuYW1lYCcpXG4gICAgfVxuXG4gICAgY29uc3QgZW5jb2RlZERvbWFpbiA9IGAke2VuY29kZVB1bnkoZG9tYWluKX1gLFxuICAgICAgICBwcm9taXNlID0gcmVxdWVzdFdob2lzKGVuY29kZWREb21haW4sIG9wdHMpXG5cbiAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHByb21pc2VcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiBjYWxsYmFjayhudWxsLCBkYXRhKSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSlcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcHJvbWlzZVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IHB1bnljb2RlID0gKGFzY2lpX29yX3VuaWNvZGU6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgY29uc3QgdHlwZSA9IGFzY2lpX29yX3VuaWNvZGUubWF0Y2goL154bi0tLykgPyAnZGVjb2RlJyA6ICdlbmNvZGUnXG4gICAgaWYgKHR5cGUgPT09ICdkZWNvZGUnKSB7XG4gICAgICAgIHJldHVybiBkZWNvZGVQdW55KGFzY2lpX29yX3VuaWNvZGUpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGVuY29kZVB1bnkoYXNjaWlfb3JfdW5pY29kZSlcbiAgICB9XG59XG4iXX0=